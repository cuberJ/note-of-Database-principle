# 事务

## 事物的定义

```mysql
# 成功的事务执行显示声明
begin transaction;
SQL 语句;
commit;
# 需要回滚的事物执行:执行SQL的时候发生了故障
begin transaction;
SQL语句;
rollback;
```



## 恢复技术

### 数据转储

管理员定期将数据库复制到其他磁盘上保存，作为备份副本

如果原始数据故障，需要将备份数据恢复到原始服务器上后，重新执行备份以后所有的操作



#### 转储方式

1. 静态转储：在系统中没有事务运行的时候进行转储。期间不允许任何存取修改活动
   1. 会降低可用性，因为用户必须等到转储结束之后才能继续使用数据库
2. 动态转储：转储期间数据库依然可以进行读取修改
   1. 不能保证副本中的数据正确
   2. 一般需要备份副本+日志文件才能将数据正确保存

3. 海量转储：每次存储所有的数据

   1. 对应的增量转储：只转储更新的数据部分

      

### 日志文件

记录事务的更新操作

#### 分类

1. 以记录为单位的日志文件
   1. 记录事务的开始标记，结束标记，每个事物的更新操作，这三个信息作为一个日志记录
      1. 内容：事务标识，操作类型（增删改查），操作对象，更新前旧值（insert操作为空），更新后新值（delete操作为空）
2. 以数据块为单位的日志文件
   1. 记录被更新的数据块以及事物标识